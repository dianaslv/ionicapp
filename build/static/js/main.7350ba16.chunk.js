(this.webpackJsonpmyApp=this.webpackJsonpmyApp||[]).push([[1],{109:function(e,t,n){},110:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(32),i=n.n(o),c=n(23),u=n(2),s=n(64),l=n(5),d=n.n(l),f=n(13),m=n(16),p=n(14),v=function(e){var t=e._id,n=e.text,a=e.breed,o=e.onEdit;return r.a.createElement(u.j,{onClick:function(){return o(t)}},r.a.createElement(u.k,null,n),r.a.createElement(u.k,null,a))},E="localhost:3001",h=function(e){return function(){for(var t,n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];return(t=console).log.apply(t,[e].concat(a))}},b=h("api");function j(e,t){return b("".concat(t," - started")),e.then((function(e){return b("".concat(t," - succeeded")),Promise.resolve(e.data)})).catch((function(e){return b("".concat(t," - failed")),Promise.reject(e)}))}var g={headers:{"Content-Type":"application/json"}},y=function(e){return{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}}},O=n(40),k=n(6),_=n(28),x=n.n(_),C="http://".concat(E,"/api/item"),w=function(e){return j(x.a.get(C,y(e)),"getItems")},A=function(e,t){return j(x.a.post(C,t,y(e)),"createItem")},S=function(e,t){return j(x.a.put("".concat(C,"/").concat(t._id),t,y(e)),"updateItem")},I=h("ws"),T="http://".concat(E,"/api/auth/login"),D=function(e,t){return j(x.a.post(T,{username:e,password:t},g),"login")},F=n(47),M=h("AuthProvider"),L={isAuthenticated:!1,isAuthenticating:!1,authenticationError:null,pendingAuthentication:!1,tokenFound:!1,username:"",storage:F.a},U=r.a.createContext(L),N=function(e){var t=e.children,n=Object(a.useState)(L),o=Object(m.a)(n,2),i=o[0],c=o[1],u=i.isAuthenticated,s=i.tokenFound,l=i.isAuthenticating,p=i.authenticationError,v=i.pendingAuthentication,E=i.username,h=i.password,b=F.a,j=Object(a.useCallback)((function(e,t){return _.apply(this,arguments)}),[]),g=Object(a.useCallback)((function(){return O.apply(this,arguments)}),[]);Object(a.useEffect)((function(){var e=!1;return function(){t.apply(this,arguments)}(),function(){e=!0};function t(){return(t=Object(f.a)(d.a.mark((function t(){var n,a,r,o;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(v){t.next=3;break}return M("authenticate, !pendingAuthentication, return"),t.abrupt("return");case 3:if(t.prev=3,M("authenticate..."),c(Object(k.a)(Object(k.a)({},i),{},{isAuthenticating:!0})),!e){t.next=8;break}return t.abrupt("return");case 8:return n=i.username,a=i.password,t.next=11,D(n,a);case 11:return r=t.sent,o=r.token,t.next=15,b.set({key:"token",value:o});case 15:M("authenticate succeeded"),c(Object(k.a)(Object(k.a)({},i),{},{pendingAuthentication:!1,isAuthenticated:!0,isAuthenticating:!1,tokenFound:!0})),t.next=25;break;case 19:if(t.prev=19,t.t0=t.catch(3),!e){t.next=23;break}return t.abrupt("return");case 23:M("authenticate failed"),c(Object(k.a)(Object(k.a)({},i),{},{authenticationError:t.t0,pendingAuthentication:!1,isAuthenticating:!1,tokenFound:!1}));case 25:case"end":return t.stop()}}),t,null,[[3,19]])})))).apply(this,arguments)}}),[v]),Object(a.useEffect)((function(){b.get({key:"token"}).then(function(){var e=Object(f.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log(t),t.value&&c(Object(k.a)(Object(k.a)({},i),{},{pendingAuthentication:!1,username:E,password:h,isAuthenticated:!0,isAuthenticating:!1,tokenFound:!0}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[]);var y={username:E,isAuthenticated:u,tokenFound:s,login:j,logout:g,isAuthenticating:l,authenticationError:p,storage:b,password:h};return M("render"),r.a.createElement(U.Provider,{value:y},t);function O(){return(O=Object(f.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.clear();case 2:c(Object(k.a)(Object(k.a)({},i),{},{isAuthenticated:!1,isAuthenticating:!1,authenticationError:null,pendingAuthentication:!1,username:"",password:"",tokenFound:!1}));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(){return(_=Object(f.a)(d.a.mark((function e(t,n){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:M("login"),s||c(Object(k.a)(Object(k.a)({},i),{},{pendingAuthentication:!0,username:t,password:n}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},J=n(69),P=h("Login"),H=function(e){var t=e.component,n=Object(J.a)(e,["component"]),o=Object(a.useContext)(U).isAuthenticated;return P("render, isAuthenticated",o),r.a.createElement(c.b,Object.assign({},n,{render:function(e){return o?r.a.createElement(t,e):r.a.createElement(c.a,{to:{pathname:"/login"}})}}))},V=h("Login"),R=function(e){e.history;var t=Object(a.useContext)(U),n=t.isAuthenticated,o=t.isAuthenticating,i=t.login,s=t.authenticationError,l=Object(a.useState)({}),d=Object(m.a)(l,2),f=d[0],p=d[1],v=f.username,E=f.password;return V("render"),n?(console.log("IT IS AUTHEN"),r.a.createElement(c.a,{to:{pathname:"/"}})):r.a.createElement(u.n,null,r.a.createElement(u.g,null,r.a.createElement(u.u,null,r.a.createElement(u.t,null,"Login"))),r.a.createElement(u.d,null,r.a.createElement(u.i,{placeholder:"Username",value:v,onIonChange:function(e){return p(Object(k.a)(Object(k.a)({},f),{},{username:e.detail.value||""}))}}),r.a.createElement(u.i,{placeholder:"Password",value:E,onIonChange:function(e){return p(Object(k.a)(Object(k.a)({},f),{},{password:e.detail.value||""}))}}),r.a.createElement(u.m,{isOpen:o}),s&&r.a.createElement("div",null,s.message||"Failed to authenticate"),r.a.createElement(u.b,{onClick:function(){V("handleLogin..."),null===i||void 0===i||i(v,E)}},"Login")))},B=h("ItemProvider"),z={fetching:!1,saving:!1},W=function(e,t){var n=t.type,a=t.payload;switch(n){case"FETCH_ITEMS_STARTED":return Object(k.a)(Object(k.a)({},e),{},{fetching:!0,fetchingError:null});case"FETCH_ITEMS_SUCCEEDED":return Object(k.a)(Object(k.a)({},e),{},{items:a.items,fetching:!1});case"FETCH_ITEMS_FAILED":return Object(k.a)(Object(k.a)({},e),{},{fetchingError:a.error,fetching:!1});case"SAVE_ITEM_STARTED":return Object(k.a)(Object(k.a)({},e),{},{savingError:null,saving:!0});case"SAVE_ITEM_SUCCEEDED":var r=Object(O.a)(e.items||[]),o=a.item,i=r.findIndex((function(e){return e._id===o._id}));return-1===i?r.splice(0,0,o):r[i]=o,Object(k.a)(Object(k.a)({},e),{},{items:r,saving:!1});case"SAVE_ITEM_FAILED":return Object(k.a)(Object(k.a)({},e),{},{savingError:a.error,saving:!1});default:return e}},q=r.a.createContext(z),$=function(e){var t=e.children,n=Object(a.useContext)(U),o=n.storage,i=n.tokenFound,c=Object(a.useReducer)(W,z),u=Object(m.a)(c,2),s=u[0],l=u[1],p=s.items,v=s.fetching,h=s.fetchingError,b=s.saving,j=s.savingError;Object(a.useEffect)((function(){var e=!1;return console.log("hey from here"),function(){t.apply(this,arguments)}(),function(){e=!0};function t(){return(t=Object(f.a)(d.a.mark((function t(){var n,a,r,i;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o.get({key:"token"});case 2:if(a=t.sent,console.log(a),null===a||void 0===a||null===(n=a.value)||void 0===n?void 0:n.trim()){t.next=6;break}return t.abrupt("return");case 6:if(t.prev=6,!(null===a||void 0===a?void 0:a.value)){t.next=20;break}return B("fetchItems started"),l({type:"FETCH_ITEMS_STARTED"}),t.next=12,w(null===a||void 0===a?void 0:a.value);case 12:if(r=t.sent,console.log(r,JSON.stringify(r)),B("fetchItems succeeded"),e){t.next=20;break}return console.log(r),t.next=19,o.set({key:"items",value:JSON.stringify(r)});case 19:l({type:"FETCH_ITEMS_SUCCEEDED",payload:{items:r}});case 20:t.next=29;break;case 22:return t.prev=22,t.t0=t.catch(6),B("fetchItems failed"),t.next=27,o.get({key:"items"});case 27:i=t.sent,l(void 0===i?{type:"FETCH_ITEMS_SUCCEEDED",payload:[]}:{type:"FETCH_ITEMS_SUCCEEDED",payload:{itemsStorage:i}});case 29:case"end":return t.stop()}}),t,null,[[6,22]])})))).apply(this,arguments)}}),[o,i]),Object(a.useEffect)((function(){o.get({key:"token"}).then((function(e){var t,n,a=!1;return B("wsEffect - connecting"),(null===e||void 0===e||null===(t=e.value)||void 0===t?void 0:t.trim())&&(n=function(e,t){var n=new WebSocket("ws://".concat(E));return n.onopen=function(){I("web socket onopen"),n.send(JSON.stringify({type:"authorization",payload:{token:e}}))},n.onclose=function(){I("web socket onclose")},n.onerror=function(e){I("web socket onerror",e)},n.onmessage=function(e){I("web socket onmessage"),t(JSON.parse(e.data))},function(){n.close()}}(null===e||void 0===e?void 0:e.value,(function(e){if(!a){var t=e.type,n=e.payload;B("ws message, item ".concat(t)),"created"!==t&&"updated"!==t||l({type:"SAVE_ITEM_SUCCEEDED",payload:{item:n}})}}))),function(){var e;B("wsEffect - disconnecting"),a=!0,null===(e=n)||void 0===e||e()}}))}),[o,i]);var g={items:p,fetching:v,fetchingError:h,saving:b,savingError:j,saveItem:Object(a.useCallback)((function(e){return y.apply(this,arguments)}),[o,i]),storage:o};return B("returns"),r.a.createElement(q.Provider,{value:g},t);function y(){return(y=Object(f.a)(d.a.mark((function e(t){var n,a,r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,B("saveItem started"),l({type:"SAVE_ITEM_STARTED"}),e.next=5,o.get({key:"token"});case 5:return n=e.sent,e.next=8,t._id?S(null===n||void 0===n?void 0:n.value,t):A(null===n||void 0===n?void 0:n.value,t);case 8:return a=e.sent,e.next=11,w(null===n||void 0===n?void 0:n.value);case 11:return r=e.sent,console.log(r),e.next=15,o.set({key:"items",value:JSON.stringify(r)});case 15:B("saveItem succeeded"),l({type:"SAVE_ITEM_SUCCEEDED",payload:{item:a}}),e.next=23;break;case 19:e.prev=19,e.t0=e.catch(0),B("saveItem failed"),l({type:"SAVE_ITEM_FAILED",payload:{error:e.t0}});case 23:case"end":return e.stop()}}),e,null,[[0,19]])})))).apply(this,arguments)}},G=h("ItemList"),K=function(e){var t=e.history,n=Object(a.useState)(void 0),o=Object(m.a)(n,2),i=o[0],c=o[1],s=Object(a.useContext)(q),l=s.items,E=s.fetching,h=s.fetchingError,b=Object(a.useState)(l),j=Object(m.a)(b,2),g=j[0],y=j[1],O=Object(a.useState)(""),k=Object(m.a)(O,2),_=k[0],x=k[1],C=Object(a.useContext)(U).storage,w=[];Object(a.useEffect)((function(){l?(console.log(l),y(l)):C.get({key:"items"}).then((function(e){console.log(null===e||void 0===e?void 0:e.value),w=JSON.parse(null===e||void 0===e?void 0:e.value),y(w)}))}),[l]),G("render");var A=Object(a.useContext)(U).logout;function S(){return(S=Object(f.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],l?(console.log(l),null===l||void 0===l||l.filter((function(e){var t=Object.assign({},e);t.breed===i&&n.push(t)})),y(n)):g&&(console.log(w),null===g||void 0===g||g.filter((function(e){var t=Object.assign({},e);t.breed===i&&n.push(t)})),y(n));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(a.useEffect)((function(){!function(e){S.apply(this,arguments)}(!0)}),[i]),r.a.createElement(u.n,null,r.a.createElement(u.g,null,r.a.createElement(u.u,null,r.a.createElement(u.t,null,"Item List"),r.a.createElement(u.f,{onClick:function(){G("handleLogout..."),null===A||void 0===A||A()}},r.a.createElement(u.h,{icon:p.j})))),r.a.createElement(u.d,null,r.a.createElement(u.m,{isOpen:E,message:"Fetching items"}),r.a.createElement(u.r,{value:i,placeholder:"Select smthg",onIonChange:function(e){return c(e.detail.value)}},g&&(null===g||void 0===g?void 0:g.map((function(e){var t=e._id,n=e.breed;return r.a.createElement(u.s,{key:t,value:n},n)})))),r.a.createElement(u.f,{onClick:function(){l?y(l):C.get({key:"items"}).then((function(e){console.log(null===e||void 0===e?void 0:e.value),w=JSON.parse(null===e||void 0===e?void 0:e.value),y(w)}))}},r.a.createElement(u.h,{icon:p.h})),r.a.createElement(u.q,{value:_,debounce:1e3,onIonChange:function(e){return x(e.detail.value)}}),g&&r.a.createElement(u.l,null,g.filter((function(e){e._id;return e.text.indexOf(_)>=0})).map((function(e){var n=e._id,a=e.text,o=e.breed;return r.a.createElement(v,{key:n,_id:n,text:a,onEdit:function(e){return t.push("/item/".concat(e))},breed:o})}))),h&&r.a.createElement("div",null,h.message||"Failed to fetch items"),l&&r.a.createElement(u.e,{vertical:"bottom",horizontal:"end",slot:"fixed"},r.a.createElement(u.f,{onClick:function(){return t.push("/item")}},r.a.createElement(u.h,{icon:p.a})))))},Q=h("ItemEdit"),X=function(e){var t=e.history,n=e.match,o=Object(a.useContext)(q),i=o.items,c=o.saving,s=o.savingError,l=o.saveItem,d=Object(a.useState)(""),f=Object(m.a)(d,2),p=f[0],v=f[1],E=Object(a.useState)(""),h=Object(m.a)(E,2),b=h[0],j=h[1],g=Object(a.useState)(),y=Object(m.a)(g,2),O=y[0],_=y[1];Object(a.useEffect)((function(){Q("useEffect");var e=n.params.id||"",t=null===i||void 0===i?void 0:i.find((function(t){return t._id===e}));_(t),t&&(v(t.text),j(t.breed))}),[n.params.id,i]);return Q("render"),r.a.createElement(u.n,null,r.a.createElement(u.g,null,r.a.createElement(u.u,null,r.a.createElement(u.t,null,"Edit"),r.a.createElement(u.c,{slot:"end"},r.a.createElement(u.b,{onClick:function(){var e=O?Object(k.a)(Object(k.a)({},O),{},{text:p,breed:b}):{text:p,breed:b};l&&l(e).then((function(){return t.goBack()}))}},"Save")))),r.a.createElement(u.d,null,r.a.createElement(u.k,null,"description"),r.a.createElement(u.i,{value:p,onIonChange:function(e){return v(e.detail.value||"")}}),r.a.createElement(u.k,null,"breed"),r.a.createElement(u.i,{value:b,onIonChange:function(e){return j(e.detail.value||"")}}),r.a.createElement(u.m,{isOpen:c}),s&&r.a.createElement("div",null,s.message||"Failed to save item")))},Y=(n(99),n(100),n(101),n(102),n(103),n(104),n(105),n(106),n(107),n(108),n(109),function(){return r.a.createElement(u.a,null,r.a.createElement(s.a,null,r.a.createElement(u.p,null,r.a.createElement(N,null,r.a.createElement(c.b,{path:"/login",component:R,exact:!0}),r.a.createElement($,null,r.a.createElement(H,{path:"/items",component:K,exact:!0}),r.a.createElement(H,{path:"/item",component:X,exact:!0}),r.a.createElement(H,{path:"/item/:id",component:X,exact:!0})),r.a.createElement(c.b,{exact:!0,path:"/",render:function(){return r.a.createElement(c.a,{to:"/items"})}})))))});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(Y,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},70:function(e,t,n){e.exports=n(110)},76:function(e,t,n){var a={"./ion-action-sheet.entry.js":[112,5],"./ion-alert.entry.js":[113,6],"./ion-app_8.entry.js":[114,7],"./ion-avatar_3.entry.js":[115,18],"./ion-back-button.entry.js":[116,19],"./ion-backdrop.entry.js":[117,43],"./ion-button_2.entry.js":[118,20],"./ion-card_5.entry.js":[119,21],"./ion-checkbox.entry.js":[120,22],"./ion-chip.entry.js":[121,23],"./ion-col_3.entry.js":[122,44],"./ion-datetime_3.entry.js":[123,10],"./ion-fab_3.entry.js":[124,24],"./ion-img.entry.js":[125,45],"./ion-infinite-scroll_2.entry.js":[126,46],"./ion-input.entry.js":[127,25],"./ion-item-option_3.entry.js":[128,26],"./ion-item_8.entry.js":[129,27],"./ion-loading.entry.js":[130,28],"./ion-menu_3.entry.js":[131,29],"./ion-modal.entry.js":[132,8],"./ion-nav_2.entry.js":[133,15],"./ion-popover.entry.js":[134,9],"./ion-progress-bar.entry.js":[135,30],"./ion-radio_2.entry.js":[136,31],"./ion-range.entry.js":[137,32],"./ion-refresher_2.entry.js":[138,11],"./ion-reorder_2.entry.js":[139,17],"./ion-ripple-effect.entry.js":[140,47],"./ion-route_4.entry.js":[141,33],"./ion-searchbar.entry.js":[142,34],"./ion-segment_2.entry.js":[143,35],"./ion-select_3.entry.js":[144,36],"./ion-slide_2.entry.js":[145,48],"./ion-spinner.entry.js":[146,13],"./ion-split-pane.entry.js":[147,49],"./ion-tab-bar_2.entry.js":[148,37],"./ion-tab_2.entry.js":[149,16],"./ion-text.entry.js":[150,38],"./ion-textarea.entry.js":[151,39],"./ion-toast.entry.js":[152,40],"./ion-toggle.entry.js":[153,12],"./ion-virtual-scroll.entry.js":[154,50]};function r(e){if(!n.o(a,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=a[e],r=t[0];return n.e(t[1]).then((function(){return n(r)}))}r.keys=function(){return Object.keys(a)},r.id=76,e.exports=r},78:function(e,t,n){var a={"./ion-icon.entry.js":[158,57]};function r(e){if(!n.o(a,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=a[e],r=t[0];return n.e(t[1]).then((function(){return n(r)}))}r.keys=function(){return Object.keys(a)},r.id=78,e.exports=r}},[[70,3,4]]]);
//# sourceMappingURL=main.7350ba16.chunk.js.map